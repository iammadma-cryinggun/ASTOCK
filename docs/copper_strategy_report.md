# 沪铜期货策略 A - 完整回测报告

## 策略概述

**策略名称**: 方案A - 利润最大化 (全火力进攻版)

**交易品种**: 沪铜期货 (CU)

**K线周期**: 4小时

**回测时间**: 2024-03-05 ~ 2026-02-03 (约2年)

---

## 核心指标系统

### 1. EMA 趋势系统
- **EMA 快线**: 5
- **EMA 慢线**: 15
- **作用**: 判断趋势方向

### 2. MACD Ratio 动能系统
- **MACD 快线**: 12
- **MACD 慢线**: 26
- **信号线**: 9
- **Ratio = DIF / DEA**: 核心动能指标
- **Ratio 阈值**: 1.15

### 3. RSI 强弱系统
- **RSI 周期**: 14
- **RSI 过滤器**: 50
- **作用**: 确认强势

### 4. STC 震荡系统
- **STC Length**: 10
- **STC Fast**: 23
- **STC Slow**: 50
- **STC 超买线**: 90
- **作用**: 逃顶止盈

---

## 交易逻辑

### 买入信号（两种）

#### 🎯 狙击开多
**条件**:
- 趋势向上: EMA5 > EMA15
- Ratio 安全区: 0 < Ratio < 1.15
- Ratio 收敛: 当前 Ratio < 前值
- 动能反转: DIF 转头向上
- RSI 强势: RSI > 50

**逻辑**: 在回调且动能衰竭时精准狙击

#### 🚀 暴力追涨
**条件**:
- EMA 金叉: EMA5 上穿 EMA15
- RSI 强势: RSI > 50

**逻辑**: 趋势启动时果断追涨（无乖离率限制）

---

### 卖出信号（三层保护）

#### 💀 硬止损 (2%)
- **触发**: 最低价 <= 入场价 × (1 - 2%)
- **作用**: 保命底线
- **约亏损**: 1500-2000 点

#### 🟣 STC 止盈
- **触发**: STC > 90 且拐头向下
- **作用**: 逃顶保住利润

#### 🔴 趋势离场
- **触发**: EMA5 < EMA15 (死叉)
- **作用**: 最后防线

---

## 回测结果

### 整体表现
```
总盈亏: +26,878 点
胜率: 61.0%
交易次数: 41 笔
```

### 详细统计
```
盈利交易: 25 笔
亏损交易: 16 笔
平均盈亏: +656 点/笔
最大盈利: +4,470 点
最大亏损: -1,692 点
```

### 交易类型分析
| 买入类型 | 次数 | 说明 |
|---------|------|------|
| 狙击开多 | ~30% | 精准回调入场 |
| 暴力追涨 | ~70% | 趋势启动追涨 |

| 卖出类型 | 次数 | 说明 |
|---------|------|------|
| 硬止损 | 1 笔 | 2% 止损触发 |
| STC 止盈 | ~70% | 主要盈利来源 |
| 趋势离场 | ~30% | 最后防线 |

---

## 性能优化

### 优化前后对比

| 指标 | 优化前 | 优化后 | 提升 |
|------|--------|--------|------|
| 指标计算 | ~0.1-0.5s | ~0.014s | **10-35倍** |
| 总耗时 | ~0.5-2s | ~0.164s | **3-12倍** |

### 关键优化点

#### 1. 移除 `df.apply()`
```python
# 优化前 (慢)
df['ratio'] = df.apply(lambda x: x['dif'] / x['dea'] if x['dea'] != 0 else 0, axis=1)

# 优化后 (快)
df['ratio'] = np.where(df['macd_dea'] != 0, df['macd_dif'] / df['macd_dea'], 0)
```

#### 2. 向量化信号计算
```python
# 优化前 (循环内逐个计算)
for i in range(len(df)):
    trend_up = (ema_fast > ema_slow)
    ratio_safe = (0 < ratio < RATIO_TRIGGER)

# 优化后 (一次性计算)
trend_up = df['ema_fast'] > df['ema_slow']
ratio_safe = (df['ratio'] > 0) & (df['ratio'] < RATIO_TRIGGER)
df['buy_signal'] = trend_up & ratio_safe & ...
```

#### 3. 使用 `shift()` 预计算前值
```python
df['ratio_prev'] = df['ratio'].shift(1)
df['dif_prev'] = df['macd_dif'].shift(1)
df['stc_prev'] = df['stc'].shift(1)
```

---

## 策略优势

1. **高胜率**: 61.0% 胜率
2. **正期望**: 平均每笔 +656 点
3. **风险可控**: 2% 硬止损 + STC 止盈
4. **性能优异**: 向量化计算，速度快
5. **双重进场**: 狙击 + 追涨，捕捉不同机会

---

## 风险提示

1. **回测偏差**: 历史表现不代表未来收益
2. **滑点成本**: 实盘交易需考虑滑点
3. **资金管理**: 建议单笔风险不超过 2%
4. **参数优化**: 需定期根据市场调整参数

---

## 文件说明

### 策略文件
- **原版**: `strategies/copper_strategy_a.py`
- **优化版**: `strategies/copper_strategy_a_optimized.py`

### 回测图表
- **原版**: `results/copper_strategy_a_backtest.png`
- **优化版**: `results/copper_strategy_a_optimized.png`

### 数据文件
- **源数据**: `D:\期货数据\沪铜4小时K线_20260203_130227.csv`

---

## 使用说明

### 快速开始
```bash
# 运行优化版策略
cd D:\daily_stock_analysis
python strategies/copper_strategy_a_optimized.py
```

### 参数调整
编辑策略文件顶部配置:
```python
EMA_FAST = 5          # EMA 快线
EMA_SLOW = 15         # EMA 慢线
RATIO_TRIGGER = 1.15  # Ratio 阈值
STOP_LOSS_PCT = 0.02  # 止损百分比
STC_SELL_ZONE = 90    # STC 超买线
```

---

## 总结

**策略 A (利润最大化版)** 在近2年的沪铜4小时K线上表现优异：
- ✅ 总盈利 +26,878 点
- ✅ 61.0% 胜率
- ✅ 风险可控（2% 止损）
- ✅ 性能优化（10-35倍速度提升）

**适合人群**:
- 追求高收益的激进型交易者
- 熟悉技术指标的量化交易者
- 需要快速回测和参数优化的研究者

**后续改进方向**:
1. 添加参数自动优化
2. 实现多品种回测
3. 集成到 daily_stock_analysis 系统
4. 添加实盘交易接口

---

*报告生成时间: 2026-02-03*
*数据来源: 沪铜4小时K线 (2024-2026)*
